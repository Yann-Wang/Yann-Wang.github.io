---
layout: post
title: XML和Unicode编码
date: 2016-11-15 
tags: [xml, unicode, encoding]
---

在html文件中，符号可以有两种表示方式: unicode(utf-8)方式和html编码方式

html文件默认是以utf-8形式存在的，所以在编辑html文件时，是看不到unicode编码的，
也无法用unicode编码来编辑文本。但是可以用html编码来编辑文本。

由于unicode编码是符号在内存中的存在形式，所以在用js动态操作文本时，
可以直接使用unicode编码，比如将'\u00a9'  版权符号插入dom节点中。

<!-- more -->

#### Unicode
>Unicode（中文：万国码、国际码、统一码、单一码）是计算机科学领域里的一项业界标准。
它对世界上大部分的文字系统进行了整理、编码，使得电脑可以用更为简单的方式来呈现和处理文字。

Unicode伴随着通用字符集的标准而发展，同时也以书本的形式对外发表。
Unicode至今仍在不断增修，每个新版本都加入更多新的字符。
目前最新的版本为2016年6月21日公布的9.0.0，
已经收入超过十万个字符（第十万个字符在2005年获采纳）。
Unicode涵盖的数据除了视觉上的字形、编码方法、标准的字符编码外，
还包含了字符特性，如大小写字母。

在表示一个Unicode的字符时，通常会用“U+”然后紧接着一组十六进制的数字来表示这一个字符。
在基本多文种平面（英文：Basic Multilingual Plane，简写BMP。又称为“零号平面”、plane 0）
里的所有字符，要用四个数字（即两个char,16bit ,例如U+4AE0，共支持六万多个字符）；
在零号平面以外的字符则需要使用五个或六个数字。旧版的Unicode标准使用相近的标记方法，
但却有些微小差异：在Unicode 3.0里使用“U-”然后紧接着八个数字，
而“U+”则必须随后紧接着四个数字。

#### Unicode的编码和实现

##### 编码方式
统一码的编码方式与ISO 10646的通用字符集概念相对应。目前实际应用的统一码版本对应于UCS-2，
使用16位的编码空间。也就是每个字符占用2个字节。这样理论上一共最多可以表示216（即65536）
个字符。基本满足各种语言的使用。实际上当前版本的统一码并未完全使用这16位编码，而是保留了大量
空间以作为特殊使用或将来扩展。
上述16位统一码字符构成基本多文种平面。最新（但未实际广泛使用）的统一码版本定义了16个辅助平面，
两者合起来至少需要占据21位的编码空间，比3字节略少。但事实上辅助平面字符仍然占用4字节编码空间，
与UCS-4保持一致。未来版本会扩充到ISO 10646-1实现级别3，即涵盖UCS-4的所有字符。
UCS-4是一个更大的尚未填充完全的31位字符集，加上恒为0的首位，共需占据32位，即4字节。
理论上最多能表示231个字符，完全可以涵盖一切语言所用的符号。
基本多文种平面的字符的编码为U+hhhh，其中每个h代表一个十六进制数字，与UCS-2编码完全相同。
而其对应的4字节UCS-4编码后两个字节一致，前两个字节则所有位均为0。

##### 实现方式
>Unicode的实现方式不同于编码方式。一个字符的Unicode编码是确定的。但是在实际传输过程中，由于不同系统平台的设计不一定一致，以及出于节省空间的目的，对Unicode编码的实现方式有所不同。Unicode的实现方式称为Unicode转换格式（Unicode Transformation Format，简称为UTF）

>例如，如果一个仅包含基本7位ASCII字符的Unicode文件，如果每个字符都使用2字节的原Unicode编码传输，其第一字节的8位始终为0。这就造成了比较大的浪费。对于这种情况，可以使用UTF-8编码，这是一种变长编码，它将基本7位ASCII字符仍用7位编码表示，占用一个字节（首位补0）。而遇到与其他Unicode字符混合的情况，将按一定算法转换，每个字符使用1-3个字节编码，并利用首位为0或1进行识别。这样对以7位ASCII字符为主的西文文档就大幅节省了编码长度（具体方案参见UTF-8）。类似的，对未来会出现的需要4个字节的辅助平面字符和其他UCS-4扩充字符，2字节编码的UTF-16也需要通过一定的算法进行转换。

>再如，如果直接使用与Unicode编码一致（仅限于BMP字符）的UTF-16编码，由于每个字符占用了两个字节，在麦金塔电脑（Mac）机和个人电脑上，对字节顺序的理解是不一致的。这时同一字节流可能会被解释为不同内容，如某字符为十六进制编码4E59，按两个字节拆分为4E和59，在Mac上读取时是从低字节开始，那么在Mac OS会认为此4E59编码为594E，找到的字符为“奎”，而在Windows上从高字节开始读取，则编码为U+4E59的字符为“乙”。就是说在Windows下以UTF-16编码保存一个字符“乙”，在Mac OS环境下打开会显示成“奎”。此类情况说明UTF-16的编码顺序若不加以人为定义就可能发生混淆，于是在UTF-16编码实现方式中使用了大端序（Big-Endian，简写为UTF-16 BE）、小端序（Little-Endian，简写为UTF-16 LE）的概念，以及可附加的字节顺序记号解决方案，目前在PC机上的Windows系统和Linux系统对于UTF-16编码默认使用UTF-16 LE。（具体方案参见UTF-16）

#### XML和Unicode

XML及其子集XHTML采用UTF-8作为标准字集，理论上我们可以在各种支持XML标准的浏览器上显示
任何地区文字的网页，只要电脑本身安装有合适的字体即可。
可以利用&#nnn;的格式显示特定的字符。nnn代表该字符的十进制Unicode代码。
如果采用十六进制代码，在编码之前加上x字符即可。但部分旧版本的浏览器可能无法识别十六进制代码。
由于Unicode版本发展原因，很多浏览器只能显示UCS-2完整字符集，也即现在使用的Unicode版本中的一个小子集。

#### XML与HTML字符实体引用

在SGML、 HTML与XML文档，如果某些Unicode字符在文档的当前编码方式(如ISO-8859-1)
中不能直接表示，那么可以通过字符值引用或者字符实体引用两种转义序列来表示这些不能直接编码的字符。
下文列出在HTML与XML文档中有效的字符实体引用。

XML规范定义了5个"预定义实体"来表示特殊字符.

|引用格式  |   字符 |  Unicode编码 |
|:-------:|:-----:|:-----------:|
| &amp;quot;  |  "    | U+0022 (34) |
| &amp;amp;   |  &    | U+0026 (38) |
| &amp;apos;  |  '    | U+0027 (39) |
| &amp;lt;    |  <    | U+003C (60) |
| &amp;gt;    |  >    | U+003E (62) |
{: .table}

##### HTML中的字符实体引用
HTML 4 DTD定义了252个命名实体。HTML 4规范要求使用标准DTD，并且不允许用户定义其它的命名实体.

#### 字符值引用
>字符值引用 (numeric character reference, NCR)是在标记语言SGML以及派生的
如HTML与XML中常见的一种转义序列结构，用来表示Unicode的通用字符集 (UCS)中的单个字符. 
NCR可以表示在一个特定文档中不能直接编码的字符，而该标记语言阅读器软件把每个NCR当作一个字符来处理。

>例如，在ISO/IEC 8859-1编码的网页文件中使用了俄文字母或者希腊字母。
由于该编码不支持这些字母，就需要用NCR来表示。网页浏览器可以正确地把这些NCR绘制为相应的
西里尔字母或希腊字母。

在SGML, HTML, XML中, 下述是希腊字母Sigma的有效的字符值引用:

| 标记语言中的字符值引用|   进位制 |   Unicode字符 |
|:-------:|:---------:|:-----------:|
| &amp;#931;  |  十进制    | U+03A3 |
| &amp;#0931; |  十进制    | U+03A3 |
| &amp;#x3A3; |  十六进制  | U+03A3 |
| &amp;#x03A3;|  十六进制  | U+03A3 |
| &amp;#x3a3; |  十六进制  | U+03A3 |
{: .table}


<div class="references">References</div>

[Unicode](https://en.wikipedia.org/wiki/Unicode)

[List of XML and HTML character entity references](https://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references)
 
[numeric character reference, NCR](https://en.wikipedia.org/wiki/Numeric_character_reference) 
 
[常用HTML转义字符](http://zqdevres.qiniucdn.com/data/20120726145112/index.html)

